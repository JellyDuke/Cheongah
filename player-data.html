<!DOCTYPE html><!--  This site was created in Webflow. https://webflow.com  --><!--  Last Published: Thu Aug 14 2025 08:02:30 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="689a08b97ed36eb33a45e1d8" data-wf-site="68908363cfa0300d0c3b5c0d">
<head>
  <meta charset="utf-8">
  <script src="config.js"></script>
  <!-- Supabase 라이브러리 추가 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // 2-1. 먼저 Supabase 클라이언트를 생성합니다. (JWT 주입이 필요 없는 일반 클라이언트)
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    /**
     * 페이지 접근 권한을 확인하는 비동기 함수입니다.
     */
    const checkAuth = async () => {
      try {
        // 2-2. Supabase에 현재 로그인된 사용자 정보가 있는지 물어봅니다.
        //      Supabase 라이브러리가 브라우저에 저장된 세션을 자동으로 확인해 줍니다.
        const { data: { user } } = await supabase.auth.getUser();

        // 2-3. 사용자 정보가 없다면, 로그인되지 않은 상태이므로 로그인 페이지로 쫓아냅니다.
        if (!user) {
          alert('접근 권한이 없습니다. 로그인이 필요합니다.');
          window.location.href = 'password.html';
        }
        // 2-4. 사용자 정보가 있다면, 아무것도 하지 않고 페이지 로드를 계속합니다.
        
      } catch (error) {
        // 오류 발생 시에도 로그인 페이지로 보냅니다.
        console.error('인증 확인 중 오류:', error);
        window.location.href = 'password.html';
      }
    };

    // 2-5. 페이지가 로드되자마자 즉시 인증 확인을 시작합니다.
    checkAuth();
  </script>
  <title>player_data</title>
  <meta content="player_data" property="og:title">
  <meta content="player_data" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/dss-stupendous-site-03ea43.webflow.css" rel="stylesheet" type="text/css">
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>
<body>
  <div id="loader-overlay" class="loader-overlay">
    <div class="loader-content">
      <div class="spinner"></div>
      <p id="loader-text">처리 중...</p>
    </div>
  </div>
  <div class="root">
    <div data-w-id="c4eeed9e-b99b-71e0-b66e-a78a7b4517fd" style="height:0px" class="top">
      <div class="top-left-wrapper">
        <div style="height:0px" class="top-logo">로고</div>
      </div>
      <div class="top-right-wrapper">
        <a href="index.html" class="button w-button">메인 페이지</a>
      </div>
    </div>
    <div class="container-player">
      <div class="player-data-input-field">
        <div class="form-block w-form">
          <form id="email-form" name="email-form" data-name="Email Form" method="get" class="form" data-wf-page-id="689a08b97ed36eb33a45e1d8" data-wf-element-id="a310cce9-d974-9ba4-9e71-2e0a5e07bb0a">
            <div class="w-layout-vflex popupframe">
              <div class="w-layout-vflex first-data-filed">
                <h1 class="title-pop">유저 정보 기입</h1>
                <div class="block-box">
                  <div>닉네임</div><input class="player-data-input w-input" type="text" id="add-nickname" required="">
                </div>
                <div class="block-box">
                  <div>주포지션</div><input class="player-data-input w-input" type="text" id="add-main-position">
                </div>
                <div class="block-box">
                  <div>서브포지션</div><input class="player-data-input w-input" type="text" id="add-sub-position">
                </div>
                <div class="block-box">
                  <div>현티어</div><input class="player-data-input w-input" placeholder="ex) 골드4" type="text" id="add-current-tier">
                </div>
                <div class="block-box">
                  <div>최고티어</div><input class="player-data-input w-input" placeholder="ex) 골드3" type="text" id="add-peak-tier">
                </div>
                <div class="w-layout-vflex flex-btn-box-popup">
                  <a href="#" onclick="hidePopup()" class="check-btn cancle w-button">취소</a>
                  <a href="#" id="add-player-button" class="check-btn check w-button">확인</a>
                </div>
              </div>
              <div class="w-layout-vflex first-data-filed-detail">
                <div class="w-layout-vflex flex-container-pop">
                  <h1 class="title-pop">유저 상세정보</h1>
                  <div class="w-layout-vflex flex-area-box">
                    <div class="w-layout-vflex flex-box-data">
                      <div class="block-box">
                        <div>닉네임</div><input class="player-data-input w-input" type="text" id="detail-nickname">
                      </div>
                      <div class="block-box">
                        <div>주포지션</div><input class="player-data-input w-input" type="text" id="detail-main-position">
                      </div>
                      <div class="block-box">
                        <div>서브포지션</div><input class="player-data-input w-input" type="text" id="detail-sub-position" >
                      </div>
                      <div class="block-box">
                        <div>현티어</div><input class="player-data-input w-input" type="text" id="detail-current-tier">
                      </div>
                      <div class="block-box">
                        <div>최고티어</div><input class="player-data-input w-input" type="text" id="detail-peak-tier">
                      </div>
                      <div class="block-box">
                        <div>시작 티어</div><input class="player-data-input w-input" type="text" id="detail-start-tier" readonly >
                      </div>
                      <div class="block-box">
                        <div>내전 티어</div><input class="player-data-input w-input" type="text" id="detail-internal-tier" readonly >
                      </div>
                    </div>
                    <div class="w-layout-vflex flex-box-data">
                      <div class="block-box">
                        <div>승률</div><input class="player-data-input w-input" type="text" id="detail-winrate" readonly>
                      </div>
                      <div class="block-box">
                        <div>승</div><input class="player-data-input w-input" type="number" id="detail-wins">
                      </div>
                      <div class="block-box">
                        <div>패</div><input class="player-data-input w-input" type="number" id="detail-losses">
                      </div>
                      <div class="block-box">
                        <div>내전 MMR</div><input class="player-data-input w-input" type="number" id="detail-mmr" readonly >
                      </div>
                      <div class="block-box">
                        <div>내전 MMR 보정값</div><input class="player-data-input w-input" type="number" id="detail-mmr-adj"readonly >
                      </div>
                      <div class="block-box">
                        <div>현재 LP</div><input class="player-data-input w-input" type="number" id="detail-lp" readonly >
                      </div>
                      <div class="block-box">
                        <div>칭호</div><input class="player-data-input w-input" type="text" id="detail-title">
                      </div>
                    </div>
                  </div>
                  <div class="w-layout-vflex flex-btn-box-popup">
                    <a href="#" onclick="hideDetailsPopup()" class="check-btn cancle w-button">취소</a>
                    <a href="#" onclick="hideDetailsPopup()" id="update-player-button" class="check-btn check w-button">확인</a>
                  </div>
                  <a href="#" onclick="handleDelete()" class="remove-player-btn w-button">유저 삭제</a>
                </div>
              </div>
            </div>
            <div class="w-layout-vflex table-wrapper">
              <div class="table _80width">
                <div fs-table-element="table" fs-table-instance="fs-table-1" class="fs-table-1_instance">
                  <table class="fs-table-1_table">
                    <tbody class="fs-table-1_body">
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>아이언4</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>825</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>아이언3</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>875</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>아이언2</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>925</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>아이언1</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>975</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>브론즈4</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1025</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>브론즈3</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1075</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>브론즈2</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1125</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>브론즈1</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1175</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>실버4</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1225</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>실버3</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1275</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>실버2</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1325</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>실버1</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1375</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>골드4</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1425</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>골드3</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1475</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>골드2</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1525</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>골드1</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1575</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>플래티넘4</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1625</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>플래티넘3</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1675</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>플래티넘2</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1725</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>플래티넘1</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1775</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>에메랄드4</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1850</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>에메랄드3</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>1950</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>에메랄드2</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>2050</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>에메랄드1</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>2150</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>다이아몬드4</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>2250</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>다이아몬드3</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>2350</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>다이아몬드2</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>2450</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>다이아몬드1</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>2600</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>마스터</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>2850</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>그랜드마스터</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>3100</div>
                          </div>
                        </td>
                      </tr>
                      <tr class="fs-table-1_row">
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>챌린저</div>
                          </div>
                        </td>
                        <td class="fs-table-1_cell">
                          <div class="table-div">
                            <div>3200</div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="table">
                <div fs-table-element="table" fs-table-instance="fs-table" class="fs-table_instance">
                  <table class="fs-table_table">
                    <tbody id="player-list-body" class="fs-table_body">
                      <tr class="fs-table_row table-top">
                        <td class="fs-table_cell">
                          <div class="table-div">
                            <div>닉네임</div>
                          </div>
                        </td>
                        <td class="fs-table_cell">
                          <div class="table-div">
                            <div>주포지션</div>
                          </div>
                        </td>
                        <td class="fs-table_cell">
                          <div class="table-div">
                            <div>서브포지션</div>
                          </div>
                        </td>
                        <td class="fs-table_cell">
                          <div class="table-div">
                            <div>승</div>
                          </div>
                        </td>
                        <td class="fs-table_cell">
                          <div class="table-div">
                            <div>패</div>
                          </div>
                        </td>
                        <td class="fs-table_cell">
                          <div class="table-div">
                            <div>현 티어</div>
                          </div>
                        </td>
                        <td class="fs-table_cell">
                          <div class="table-div">
                            <div>최고티어</div>
                          </div>
                        </td>
                        <td class="fs-table_cell">
                          <div class="table-div">
                            <div>내전 티어</div>
                          </div>
                        </td>
                        <td class="fs-table_cell">
                          <div class="table-div">
                            <div>현재 LP</div>
                          </div>
                        </td>
                        <td class="fs-table_cell">
                          <div class="table-div">
                            <div>칭호</div>
                          </div>
                        </td>
                        <td class="fs-table_cell">
                          <div class="table-div">
                            <div>상세정보</div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <a href="#" onclick="showPopup()" class="write-btn w-inline-block"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewbox="0 0 24 25" fill="none" app="ikonik" class="ikonik-oi5di">
        <path d="M6.6273 20.5959L4.56826 18.5368L3.78386 17.7524L2.99946 16.968C2.80336 17.2622 2.70531 17.6544 2.60726 17.9485L1.03847 22.753C0.940416 23.1452 1.03847 23.4393 1.23456 23.7335C1.43066 23.9296 1.82286 24.0276 2.21506 23.9296L7.0195 22.4588C7.4117 22.3608 7.70585 22.1647 8 22.0666L7.31365 21.3803L6.6273 20.5959Z" fill="currentColor" app="ikonik" class="path-n5p8l"></path>
        <path d="M21.9098 3.09167C21.0911 2.37662 20.17 1.96802 19.0443 1.96802C17.9185 1.96802 16.7927 2.47877 15.974 3.29597L4 15.3497L4.71639 16.0648L5.43279 16.7798L8.19602 19.5379L8.91241 20.253L9.6288 20.968L21.7052 8.91425C23.3426 7.27985 23.445 4.62393 21.9098 3.09167Z" fill="currentColor" app="ikonik" class="path-hukm2"></path>
      </svg></a>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=68908363cfa0300d0c3b5c0d" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <script>
    function showPopup() {
      const popup = document.querySelector('.popupframe');
      const firstField = document.querySelector('.popupframe .first-data-filed');

      popup.style.display = 'flex';
      firstField.style.display = 'flex';
    }

    function hidePopup() {
        const popup = document.querySelector('.popupframe');
        const firstField = document.querySelector('.popupframe .first-data-filed');

        firstField.style.display = 'none';
        popup.style.display = 'none';
    }
    //리모컨
    //const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    let currentPlayerOriginalData = null;
    /**
    * Supabase에서 모든 플레이어 데이터를 가져오는 새로운 함수
    */
  async function getPlayerData() {
  // 1. "불러오는 중..." 로딩 화면을 표시합니다.
    showLoader("플레이어 목록을 불러오는 중...");

    try {
      // 2. Supabase에서 데이터를 가져옵니다.
      const { data, error } = await supabase
        .from('players')
        .select('*')
        .order('created_at', { ascending: true });

      // 3. 오류가 발생하면, 오류를 발생시켜 catch 블록으로 보냅니다.
      if (error) {
        throw error;
      }

      // 4. 데이터를 테이블이 이해할 수 있는 형식으로 변환합니다.
      const a_playerData = data.map(player => [
          player.nickname, player.main_position, player.sub_position,
          player.current_tier, player.peak_tier, player.start_tier,
          player.internal_tier, player.winrate, player.wins,
          player.losses, player.mmr, player.mmr_adj,
          player.lp, player.title
      ]);
      
      // 5. 변환된 데이터로 테이블을 그립니다.
      buildPlayerTable(a_playerData);

    } catch (error) {
      // 6. 오류가 발생하면, 콘솔에 기록하고 사용자에게 에러 토스트 알림을 보여줍니다.
      console.error("데이터 불러오기 오류:", error);
      showErrorToast("데이터를 불러오는 데 실패했습니다.");
    } finally {
      // 7. 성공하든 실패하든, 마지막에는 항상 로딩 화면을 숨깁니다.
      hideLoader();
    }
  }

    // 3. 테이블을 그리는 함수 (새로 추가)
    function buildPlayerTable(playerData) {
      // HTML에서 id="player-list-body"를 가진 tbody를 찾습니다.
      const tableBody = document.getElementById('player-list-body');
      if (!tableBody) {
        console.error('오류: id가 "player-list-body"인 tbody를 찾을 수 없습니다.');
        return;
      }
      
      // 테이블을 새로 그리기 전에, 헤더를 제외한 기존 데이터 행을 모두 삭제합니다.
      while (tableBody.children.length > 1) {
        tableBody.removeChild(tableBody.lastChild);
      }

      // 받아온 데이터(playerData)의 각 행(player)에 대해 반복합니다.
      playerData.forEach(player => {
        const nickname = String(player[0] || '');
        if (nickname === '') return; // 닉네임이 없으면 건너뛰기
        
        const row = document.createElement('tr');
        // HTML에 정의된 클래스 이름을 사용합니다. (예: fs-table_row)
        row.className = 'fs-table_row'; 
        
        // 테이블에 표시될 데이터 순서 (시트 순서와 일치)
        const rowData = [
          `<div>${nickname}</div>`,
          `<div>${String(player[1] || '')}</div>`, // 주포지션
          `<div>${String(player[2] || '')}</div>`, // 서브포지션
          `<div>${String(player[8] || 0)}</div>`,  // 승
          `<div>${String(player[9] || 0)}</div>`,  // 패
          `<div>${String(player[3] || '')}</div>`, // 현 티어
          `<div>${String(player[4] || '')}</div>`, // 최고티어
          `<div>${String(player[6] || 'N/A')}</div>`, // 내전 티어
          `<div>${String(player[12] || 0)}</div>`, // 현재 LP
          `<div>${String(player[13] || '')}</div>`, // 칭호
          `<a href="#" onclick="showPlayerDetails('${nickname.replace(/'/g, "\\'")}')" class="info-btn w-button">상세정보</a>`
        ];

        // 각 데이터로 셀(td)을 만들어 행(tr)에 추가합니다.
        rowData.forEach(cellHtml => {
          const cell = document.createElement('td');
          cell.className = 'fs-table_cell'; // HTML 클래스명 확인 필요
          cell.innerHTML = `<div class="table-div sub">${cellHtml}</div>`;
          row.appendChild(cell);
        });

        // 완성된 행을 테이블 본문에 추가합니다.
        tableBody.appendChild(row);
      });
    }
    /**
   * '유저 정보 기입' 팝업의 데이터를 Supabase에 저장하는 새로운 함수
   */
    /**
 * '유저 정보 기입' 팝업의 데이터를 Supabase에 저장하는 함수 (로더/알림 적용)
 */
  async function addNewPlayer() {
    // 1. 팝업의 각 입력창에서 값을 읽어옵니다.
    const nickname = document.getElementById('add-nickname').value;
    const main_position = document.getElementById('add-main-position').value;
    const sub_position = document.getElementById('add-sub-position').value;
    const current_tier = document.getElementById('add-current-tier').value;
    const peak_tier = document.getElementById('add-peak-tier').value;

    // 2. 닉네임이 비어있는지 확인하고, 없으면 에러 알림을 표시합니다.
    if (!nickname) {
      showErrorToast("닉네임은 필수 항목입니다.");
      return;
    }
     
    // 3. "추가하는 중..." 로딩 화면을 표시합니다.
    showLoader("새 플레이어를 추가하는 중...");

    try {
      // 3. 닉네임 중복 체크
      const { data: existingPlayers, error: fetchError } = await supabase
        .from('players')
        .select('id')
        .eq('nickname', nickname);

      if (fetchError) throw fetchError; 

      if (existingPlayers && existingPlayers.length > 0) {
        showErrorToast("이미 존재하는 닉네임입니다.");
        return; // 중복이면 추가 진행 안 함
      }
      // 4. MMR 및 보정치를 자동으로 계산합니다.
      const initialInternalTier = current_tier;
      const baseMmr = getMmrByTier(initialInternalTier);
      
      const peakTierIndex = TIER_ORDER.indexOf(peak_tier);
      const currentTierIndex = TIER_ORDER.indexOf(current_tier);
      let mmrAdjustment = 0;
      if (peakTierIndex > -1 && currentTierIndex > -1 && peakTierIndex > currentTierIndex) {
          const tierDifference = peakTierIndex - currentTierIndex;
          mmrAdjustment = tierDifference * 15;
      }
      const finalMmr = baseMmr + mmrAdjustment;

      // 5. Supabase에 저장할 최종 데이터 객체를 만듭니다.
      const newPlayerData = {
        nickname: nickname,
        main_position: main_position,
        sub_position: sub_position,
        current_tier: current_tier,
        peak_tier: peak_tier,
        start_tier: current_tier,
        internal_tier: initialInternalTier,
        mmr: finalMmr,
        mmr_adj: mmrAdjustment,
      };

      // 6. Supabase에 데이터를 삽입(insert)합니다.
      const { data, error } = await supabase
        .from('players')
        .insert([newPlayerData]);

      if (error) {
        throw error; // 오류가 발생하면 catch 블록으로 보냅니다.
      }

      // 7. 성공하면, 성공 토스트 알림을 보여주고 테이블을 새로고침합니다.
      showSuccessToast("새로운 플레이어가 추가되었습니다!");
      getPlayerData();

    } catch (error) {
      // 8. 오류가 발생하면, 콘솔에 기록하고 에러 토스트 알림을 보여줍니다.
      console.error("데이터 추가 오류:", error);
      showErrorToast("데이터 추가에 실패했습니다: " + error.message);
    } finally {
      // 9. 성공하든 실패하든, 마지막에는 팝업과 로딩 화면을 숨깁니다.
      hidePopup();
      hideLoader();
    }
  }

    // 4. 오류 처리 함수 (새로 추가)
    function onFailure(error) {
      alert("오류가 발생했습니다: " + error.message);
    }

    /**
 * '상세정보' 버튼 클릭 시 호출되는 함수
 * @param {string} nickname - 테이블에서 클릭된 플레이어의 닉네임
 */
  async function showPlayerDetails(nickname) {
    // Supabase의 'players' 테이블에서 닉네임이 일치하는(eq) 첫 번째 데이터를 찾습니다.
    const { data, error } = await supabase
      .from('players')
      .select('*')
      .eq('nickname', nickname)
      .single(); // .single()은 결과가 하나일 때 사용합니다.

    if (error) {
      console.error("상세 정보 조회 오류:", error);
      onFailure(error);
    } else if (data) {
      // 데이터를 성공적으로 찾았으면, 팝업을 채우는 함수를 호출합니다.
      populateDetailsPopup(data);
    }
  }

  /**
   * 서버에서 받은 데이터로 '상세정보' 팝업의 입력창을 채우는 함수
   */
  /**
 * 서버에서 받은 데이터로 '상세정보' 팝업의 입력창을 채우는 함수
 */
  function populateDetailsPopup(playerData) {
    // 1. 나중에 LP 계산 시 비교할 수 있도록, 플레이어의 원본 데이터를 전역 변수에 저장합니다.
    currentPlayerOriginalData = playerData;

    // 2. 승/패 데이터를 기반으로 승률을 다시 계산하여 표시합니다.
    const wins = Number(playerData.wins) || 0;
    const losses = Number(playerData.losses) || 0;
    const totalGames = wins + losses;
    const formattedWinrate = totalGames > 0 ? ((wins / totalGames) * 100).toFixed(1) + '%' : 'N/A';

    // 3. HTML의 각 input 요소에 ID를 기준으로 데이터 값을 할당합니다.
    document.getElementById('detail-nickname').value = playerData.nickname || '';
    document.getElementById('detail-main-position').value = playerData.main_position || '';
    document.getElementById('detail-sub-position').value = playerData.sub_position || '';
    document.getElementById('detail-current-tier').value = playerData.current_tier || '';
    document.getElementById('detail-peak-tier').value = playerData.peak_tier || '';
    document.getElementById('detail-start-tier').value = playerData.start_tier || '';
    document.getElementById('detail-internal-tier').value = playerData.internal_tier || '';
    document.getElementById('detail-winrate').value = formattedWinrate;
    document.getElementById('detail-wins').value = wins;
    document.getElementById('detail-losses').value = losses;
    document.getElementById('detail-mmr').value = playerData.mmr || 1500;
    document.getElementById('detail-mmr-adj').value = playerData.mmr_adj || 0;
    document.getElementById('detail-lp').value = playerData.lp || 0;
    document.getElementById('detail-title').value = playerData.title || '';

    // 4. 팝업창들을 화면에 표시합니다.
    document.querySelector('.popupframe').style.display = 'flex';
    document.querySelector('.first-data-filed').style.display = 'none'; // '정보 기입' 팝업은 숨김
    document.querySelector('.first-data-filed-detail').style.display = 'flex'; // '상세 정보' 팝업은 표시
  }

  /**
 * '수정 완료' 버튼 클릭 시, 모든 자동 계산 로-직을 수행하고
 * Supabase 데이터를 업데이트하는 최종 함수
 */
  async function handleUpdate() {
    // --- 1. 원본 데이터 확인 ---
    if (!currentPlayerOriginalData) {
      showErrorToast("플레이어 원본 데이터를 불러오지 못했습니다.");
      return;
    }

    // --- 2. "수정하는 중..." 로딩 화면 표시 ---
    showLoader("플레이어 정보를 수정하는 중...");

    try {
      // --- 3. 팝업에서 사용자가 수정한 값들 가져오기 ---
      const newWins = Number(document.getElementById('detail-wins').value) || 0;
      const newLosses = Number(document.getElementById('detail-losses').value) || 0;
      const current_tier = document.getElementById('detail-current-tier').value;
      const peak_tier = document.getElementById('detail-peak-tier').value;
      
      // --- 4. LP 및 티어 계산을 위한 변수 초기화 ---
      const oldWins = Number(currentPlayerOriginalData.wins) || 0;
      const oldLosses = Number(currentPlayerOriginalData.losses) || 0;
      let currentLp = Number(currentPlayerOriginalData.lp) || 0;
      let internalTier = currentPlayerOriginalData.internal_tier || '아이언4';
      
      // --- 5. LP 및 티어 자동 변동 로직 ---
      const totalGames = newWins + newLosses;
      if (totalGames >= 5) {
        const winDifference = newWins - oldWins;
        const lossDifference = newLosses - oldLosses;

        if (winDifference > 0) { // 승리 기록
          for (let i = 0; i < winDifference; i++) {
            const tempWinrate = ((oldWins + i) / (oldWins + i + oldLosses) * 100) || 50;
            const winrateKey = Math.floor(tempWinrate / 5) * 5;
            const lpChange = LP_DATA[winrateKey] ? LP_DATA[winrateKey][0] : 45;
            currentLp += lpChange;
          }
        }
        if (lossDifference > 0) { // 패배 기록
          for (let i = 0; i < lossDifference; i++) {
            const tempWinrate = (newWins / (newWins + oldLosses + lossDifference - 1 - i) * 100) || 50;
            const winrateKey = Math.floor(tempWinrate / 5) * 5;
            const lpChange = LP_DATA[winrateKey] ? LP_DATA[winrateKey][1] : -30;
            currentLp += lpChange;
          }
        }

        // 승급/강등 처리
        while (currentLp >= 100) {
          const currentTierIndex = TIER_ORDER.indexOf(internalTier);
          if (currentTierIndex < TIER_ORDER.length - 1) {
            internalTier = TIER_ORDER[currentTierIndex + 1];
            currentLp -= 100;
          } else { currentLp = 100; break; }
        }
        while (currentLp < 0) {
          const currentTierIndex = TIER_ORDER.indexOf(internalTier);
          if (currentTierIndex > 0) {
            internalTier = TIER_ORDER[currentTierIndex - 1];
            currentLp += 100;
          } else { currentLp = 0; break; }
        }
      }

      // ⭐ --- 6. 새로운 MMR 보정치 자동 계산 로직 --- ⭐
      let mmrAdjustment = 0;
      // 기본 MMR은 항상 위에서 계산된 '내전 티어(internalTier)'를 기준으로 합니다.
      const baseMmr = getMmrByTier(internalTier); 
      
      const peakTierIndex = TIER_ORDER.indexOf(peak_tier);
      const internalTierIndex = TIER_ORDER.indexOf(internalTier);

      // '최고 티어'가 '내전 티어'보다 높을 경우에만 "잠재력 보너스"를 계산합니다.
      if (peakTierIndex > -1 && internalTierIndex > -1 && peakTierIndex > internalTierIndex) {
        // 격차 = 최고 티어 인덱스 - 내전 티어 인덱스
        const tierDifference = peakTierIndex - internalTierIndex;
        // 격차에 가중치(15)를 곱하여 보정치를 부여합니다.
        mmrAdjustment = tierDifference * 15;
      }
      // (만약 내전 티어가 최고 티어와 같거나 높아지면, 보정치는 자동으로 0이 됩니다.)

      // --- 7. 최종 데이터 정리 ---
      const finalWinrate = totalGames > 0 ? ((newWins / totalGames) * 100).toFixed(1) + '%' : 'N/A';
      // 최종 MMR = 내전 티어 기준 기본 MMR + 잠재력 보너스
      const finalMmr = baseMmr + mmrAdjustment;

      const updatedData = {
        main_position: document.getElementById('detail-main-position').value,
        sub_position: document.getElementById('detail-sub-position').value,
        current_tier: current_tier,
        peak_tier: peak_tier,
        start_tier: document.getElementById('detail-start-tier').value,
        title: document.getElementById('detail-title').value,
        wins: newWins,
        losses: newLosses,
        winrate: finalWinrate,
        internal_tier: internalTier,
        mmr: finalMmr,
        mmr_adj: mmrAdjustment,
        lp: currentLp,
      };

      // --- 8. Supabase에 최종 데이터 업데이트 ---
      const { data, error } = await supabase
        .from('players')
        .update(updatedData)
        .eq('nickname', currentPlayerOriginalData.nickname);

      if (error) {
        throw error;
      }

      // --- 9. 성공 처리 ---
      let message = "플레이어 정보가 수정되었습니다!";
      if (totalGames < 5 && ((newWins - oldWins) > 0 || (newLosses - oldLosses) > 0)) {
        message += " (5판 미만 플레이하여 LP는 변동되지 않습니다.)";
      }
      showSuccessToast(message);
      getPlayerData();

    } catch (error) {
      // --- 10. 실패 처리 ---
      console.error("데이터 수정 오류:", error);
      showErrorToast("정보 수정에 실패했습니다: " + error.message);
    } finally {
      // --- 11. 마무리 작업 ---
      hideDetailsPopup();
      hideLoader();
    }
  }
   // 페이지가 모두 로드된 후 실행
  document.addEventListener('DOMContentLoaded', function() {
    // 1. 페이지가 열리면 바로 전체 플레이어 목록을 불러옵니다.
    getPlayerData();

    // 2. '유저 정보 기입' 팝업의 '확인' 버튼에 addNewPlayer 함수를 연결합니다.
    const addBtn = document.getElementById('add-player-button');
    if (addBtn) {
      addBtn.addEventListener('click', function(event) {
        event.preventDefault(); // 링크의 기본 동작 방지
        addNewPlayer();
      });
    }

    // 3. '상세정보' 팝업의 '수정 완료' 버튼에 handleUpdate 함수를 연결합니다.
    const updateBtn = document.getElementById('update-player-button');
    if (updateBtn) {
      updateBtn.addEventListener('click', function(event) {
        event.preventDefault();
        handleUpdate();
      });
    }
  });

  /**
 * 상세정보 팝업 클릭 시 팝업을 닫는 함수
 */
  function hideDetailsPopup() {
      const popup = document.querySelector('.popupframe');
        const firstField = document.querySelector('.popupframe .first-data-filed-detail');
        popup.style.display = 'none';
        firstField.style.display = 'none';
  }
  function getMmrByTier(tierString) {
    if (!tierString) return 1500;
    // 띄어쓰기 없는 한글 티어를 바로 키로 사용
    return MMR_DATA[tierString.replace(/\s+/g, '')] || 1500;
  }
  /**
 * '유저 삭제' 버튼 클릭 시 호출되는 함수 (로더/알림 적용)
 */
  async function handleDelete() {
    const nickname = document.getElementById('detail-nickname').value;
    if (!nickname) {
      showErrorToast('삭제할 플레이어 정보가 올바르게 로드되지 않았습니다.');
      return;
    }

    // confirm 대신, 더 나은 UI의 커스텀 확인창을 사용하는 것을 추천하지만,
    // 우선 기존 confirm을 유지합니다.
    const message = `정말로 '${nickname}' 님의 데이터를 영구적으로 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다.`;
    
    if (confirm(message)) {
      // 1. "삭제하는 중..." 로딩 화면을 표시합니다.
      showLoader("플레이어를 삭제하는 중...");

      try {
        // 2. Supabase에 삭제 명령을 보냅니다.
        const { error } = await supabase
          .from('players')
          .delete()
          .eq('nickname', nickname);

        if (error) {
          throw error;
        }

        // 3. 성공하면, 성공 토스트 알림을 보여주고 테이블을 새로고침합니다.
        showSuccessToast(`'${nickname}' 님의 데이터가 삭제되었습니다.`);
        getPlayerData();

      } catch (error) {
        // 4. 오류가 발생하면, 콘솔에 기록하고 에러 토스트 알림을 보여줍니다.
        console.error("데이터 삭제 오류:", error);
        showErrorToast("데이터 삭제에 실패했습니다: " + error.message);
      } finally {
        // 5. 성공하든 실패하든, 마지막에는 팝업과 로딩 화면을 숨깁니다.
        hidePopup();
        hideLoader();
        hideDetailsPopup();
      }
    }
  }


  
  </script>
</body>
</html>